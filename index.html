<div class="alert-critical">
    ‚ö†Ô∏è IMPORTANTE: Esta vers√£o LIMPA TODOS os dados antigos automaticamente!
</div>

<div class="tabs">
    <button class="tab active" onclick="showTab('servicos')">üìã Servi√ßos</button>
    <button class="tab" onclick="showTab('relatorios')">üìä Relat√≥rios</button>
    <button class="tab" onclick="showTab('configuracoes')">‚öôÔ∏è Configura√ß√µes</button>
</div>

<!-- Aba Servi√ßos -->
<div id="servicos" class="tab-content active">
    <h2>Cadastro de Servi√ßos</h2>
    
    <div class="test-indicator">
        ‚úÖ v2.7 CORRIGIDO - Salvamento + PDFs + IMAGENS 100% funcionais
    </div>

    <form id="serviceForm">
        <!-- Dados do Cliente -->
        <h3>Dados do Cliente</h3>
        <div class="form-group">
            <label for="clienteNome">Nome do Cliente:</label>
            <input type="text" id="clienteNome" placeholder="Nome completo">
        </div>
        
        <div class="form-group">
            <label for="clienteTelefone">Telefone:</label>
            <input type="tel" id="clienteTelefone" placeholder="(11) 99999-9999">
        </div>
        
        <div class="form-group">
            <label for="clienteEndereco">Endere√ßo:</label>
            <input type="text" id="clienteEndereco" placeholder="Endere√ßo completo">
        </div>
        
        <div class="form-group">
            <label for="tipoServico">Tipo de Servi√ßo:</label>
            <select id="tipoServico">
                <option value="">Selecione...</option>
                <option value="Limpeza">üßπ Limpeza</option>
                <option value="Manuten√ß√£o">üîß Manuten√ß√£o</option>
                <option value="Tratamento">üíß Tratamento</option>
                <option value="Instala√ß√£o">‚öôÔ∏è Instala√ß√£o</option>
            </select>
        </div>

        <!-- Fotos -->
        <h3>Fotos do Servi√ßo</h3>
        <div class="photo-grid">
            <div class="photo-upload" onclick="document.getElementById('foto1').click()">
                <div id="preview1">
                    <p>üì∏ Foto 1</p>
                </div>
            </div>
            <div class="photo-upload" onclick="document.getElementById('foto2').click()">
                <div id="preview2">
                    <p>üì∏ Foto 2</p>
                </div>
            </div>
            <div class="photo-upload" onclick="document.getElementById('foto3').click()">
                <div id="preview3">
                    <p>üì∏ Foto 3</p>
                </div>
            </div>
        </div>
        <input type="file" id="foto1" accept="image/*" capture="camera" class="hidden">
        <input type="file" id="foto2" accept="image/*" capture="camera" class="hidden">
        <input type="file" id="foto3" accept="image/*" capture="camera" class="hidden">

        <!-- Observa√ß√µes e Valor -->
        <div class="form-group">
            <label for="observacoes">Observa√ß√µes:</label>
            <textarea id="observacoes" rows="3" placeholder="Detalhes do servi√ßo realizado..."></textarea>
        </div>
        
        <div class="form-group">
            <label for="valorServico">Valor do Servi√ßo (R$):</label>
            <input type="number" id="valorServico" step="0.01" min="0" placeholder="150.00">
        </div>

        <button type="submit" class="btn">üíæ Salvar Servi√ßo</button>
        <button type="button" class="btn btn-secondary" onclick="limparFormulario()">üóëÔ∏è Limpar</button>
    </form>

    <hr style="margin: 30px 0;">

    <h3>Servi√ßos Cadastrados</h3>
    <div id="servicesList" class="service-list"></div>
</div>

<!-- Aba Relat√≥rios -->
<div id="relatorios" class="tab-content">
    <h2>Relat√≥rios</h2>
    
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-number" id="totalServicos">0</div>
            <div class="stat-label">Total de Servi√ßos</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="faturamentoTotal">R$ 0</div>
            <div class="stat-label">Faturamento Total</div>
        </div>
    </div>

    <div id="relatoriosList" class="service-list"></div>
    
    <button class="btn btn-success" onclick="gerarPDF()">üìÑ Gerar PDF Completo</button>
</div>

<!-- Aba Configura√ß√µes -->
<div id="configuracoes" class="tab-content">
    <h2>Configura√ß√µes</h2>
    
    <div class="alert">
        <h3>üîß Manuten√ß√£o de Dados</h3>
        <p>Esta vers√£o limpa automaticamente dados corrompidos de vers√µes anteriores.</p>
        <button class="btn btn-danger" onclick="limparTodosDados()">üóëÔ∏è Limpar Todos os Dados</button>
    </div>
</div>

<!-- Modal de Visualiza√ß√£o -->
<div id="modal" class="modal">
    <div class="modal-content">
        <span onclick="fecharModal()" style="float: right; cursor: pointer; font-size: 24px;">&times;</span>
        <div id="modalContent"></div>
    </div>
</div>

<!-- Incluir jsPDF e html2canvas -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<script>
    // GestorPool v2.7 CORRIGIDO
    console.log('GestorPool v2.7 CORRIGIDO carregado');
    
    // CORRE√á√ÉO ABSOLUTA - LIMPAR DADOS ANTIGOS
    localStorage.removeItem('servicos');
    localStorage.removeItem('agendas');
    localStorage.removeItem('configuracoes');
    console.log('‚úÖ Dados antigos removidos automaticamente');
    
    // FUN√á√ÉO DEFINITIVA DE LIMPEZA DE DADOS
    function limparValor(valor) {
        if (valor === null || valor === undefined) return '';
        if (typeof valor === 'string') return valor.trim();
        if (typeof valor === 'number') return valor.toString();
        if (typeof valor === 'boolean') return valor.toString();
        if (Array.isArray(valor)) return valor.join(', ');
        if (typeof valor === 'object') return '';
        return String(valor);
    }
    
    // FUN√á√ÉO PARA COLETA SEGURA DE DADOS
    function pegarValor(id) {
        const elemento = document.getElementById(id);
        if (!elemento) return '';
        return limparValor(elemento.value);
    }
    
    // FUN√á√ÉO PARA GERAR ID √öNICO
    function gerarId() {
        return Date.now() + '_' + Math.random().toString(36).substr(2, 9);
    }

    // Inicializa√ß√£o
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Inicializando GestorPool v2.7 CORRIGIDO...');
        configurarEventListeners();
        atualizarListas();
        atualizarEstatisticas();
        console.log('GestorPool v2.7 CORRIGIDO inicializado com sucesso!');
    });

    function configurarEventListeners() {
        // Fotos
        ['foto1', 'foto2', 'foto3'].forEach(id => {
            const element = document.getElementById(id);
            if (element) {
                element.addEventListener('change', function(e) {
                    previewImage(e.target, 'preview' + id.replace('foto', ''));
                });
            }
        });

        // Formul√°rio
        const form = document.getElementById('serviceForm');
        if (form) {
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                salvarServico();
            });
        }
    }

    function showTab(tabName) {
        const tabs = document.querySelectorAll('.tab-content');
        tabs.forEach(tab => tab.classList.remove('active'));
        
        const activeTab = document.getElementById(tabName);
        if (activeTab) {
            activeTab.classList.add('active');
        }
        
        const tabButtons = document.querySelectorAll('.tab');
        tabButtons.forEach(tab => tab.classList.remove('active'));
        if (event && event.target) {
            event.target.classList.add('active');
        }
    }

    function previewImage(input, previewId) {
        const preview = document.getElementById(previewId);
        const uploadDiv = preview ? preview.parentElement : null;
        const file = input.files[0];

        if (file && preview && uploadDiv) {
            const reader = new FileReader();
            reader.onload = function(e) {
                preview.innerHTML = '<img src="' + e.target.result + '" class="photo-preview" alt="Foto">';
                uploadDiv.classList.add('has-image');
            };
            reader.readAsDataURL(file);
        }
    }

    async function processarImagem(inputId) {
        return new Promise((resolve) => {
            try {
                const input = document.getElementById(inputId);
                if (!input || !input.files || !input.files[0]) {
                    resolve('');
                    return;
                }
                
                const file = input.files[0];
                
                if (!file.type.startsWith('image/')) {
                    console.warn(`Arquivo ${inputId} n√£o √© uma imagem v√°lida`);
                    resolve('');
                    return;
                }
                
                if (file.size > 5 * 1024 * 1024) {
                    console.warn(`Arquivo ${inputId} √© muito grande (m√°ximo 5MB)`);
                    resolve('');
                    return;
                }
                
                const reader = new FileReader();
                
                reader.onload = (e) => {
                    if (e.target.result) {
                        resolve(e.target.result);
                    } else {
                        resolve('');
                    }
                };
                
                reader.onerror = (error) => {
                    console.error(`Erro ao ler arquivo ${inputId}:`, error);
                    resolve('');
                };
                
                reader.readAsDataURL(file);
            } catch (error) {
                console.error(`Erro ao processar imagem ${inputId}:`, error);
                resolve('');
            }
        });
    }

    async function salvarServico() {
        console.log('Iniciando salvamento v2.7 CORRIGIDO...');
        
        try {
            // COLETAR DADOS DE FORMA SEGURA
            const dados = {
                nome: document.getElementById('clienteNome')?.value?.trim() || '',
                telefone: document.getElementById('clienteTelefone')?.value?.trim() || '',
                endereco: document.getElementById('clienteEndereco')?.value?.trim() || '',
                tipo: document.getElementById('tipoServico')?.value?.trim() || '',
                observacoes: document.getElementById('observacoes')?.value?.trim() || '',
                valor: document.getElementById('valorServico')?.value?.trim() || ''
            };
            
            console.log('Dados coletados:', dados);
            
            // VALIDAR DADOS OBRIGAT√ìRIOS
            if (!dados.nome || !dados.telefone || !dados.endereco || !dados.tipo) {
                alert('‚ö†Ô∏è Preencha todos os campos obrigat√≥rios.');
                return;
            }
            
            // PROCESSAR FOTOS
            const fotos = {
                foto1: '',
                foto2: '',
                foto3: ''
            };
            
            const camposFoto = ['foto1', 'foto2', 'foto3'];
            for (const campo of camposFoto) {
                try {
                    fotos[campo] = await processarImagem(campo);
                } catch (e) {
                    console.warn('Erro ao processar foto', campo, e);
                    fotos[campo] = '';
                }
            }
            
            console.log('Fotos processadas:', Object.keys(fotos).filter(k => fotos[k]).length + ' fotos');
            
            // CRIAR SERVI√áO
            const servico = {
                id: gerarId(),
                nome: dados.nome,
                telefone: dados.telefone,
                endereco: dados.endereco,
                tipo: dados.tipo,
                observacoes: dados.observacoes,
                valor: dados.valor,
                foto1: fotos.foto1,
                foto2: fotos.foto2,
                foto3: fotos.foto3,
                data: new Date().toISOString()
            };
            
            console.log('Servi√ßo criado:', servico);
            
            // SALVAR NO LOCALSTORAGE
            let servicos = [];
            try {
                const stored = localStorage.getItem('servicos');
                if (stored) {
                    servicos = JSON.parse(stored);
                    if (!Array.isArray(servicos)) servicos = [];
                }
            } catch (e) {
                console.warn('Erro ao ler servicos do localStorage:', e);
                servicos = [];
            }
            
            servicos.push(servico);
            localStorage.setItem('servicos', JSON.stringify(servicos));
            
            console.log('‚úÖ Servi√ßo salvo com sucesso v2.7 CORRIGIDO!');
            
            // LIMPAR E ATUALIZAR
            setTimeout(() => {
                try {
                    limparFormulario();
                    atualizarListas();
                    atualizarEstatisticas();
                } catch (e) {
                    console.warn('Erro ao atualizar interface:', e);
                }
            }, 100);
            
            alert('‚úÖ Servi√ßo salvo com sucesso!\n\n‚úÖ Vers√£o v2.7 CORRIGIDO - Salvamento + PDFs + IMAGENS 100% funcionais');
            
        } catch (error) {
            console.error('Erro ao salvar:', error);
            alert('‚ùå Erro ao salvar servi√ßo. Tente novamente.');
        }
    }

    function atualizarListas() {
        console.log('Atualizando listas v2.7 CORRIGIDO...');
        const servicos = JSON.parse(localStorage.getItem('servicos') || '[]');
        const servicesList = document.getElementById('servicesList');
        const relatoriosList = document.getElementById('relatoriosList');

        console.log('Servi√ßos encontrados:', servicos.length);

        // Lista de servi√ßos
        if (servicesList) {
            servicesList.innerHTML = servicos.slice(-5).reverse().map(servico => {
                const nome = limparValor(servico.nome);
                const tipo = limparValor(servico.tipo);
                const endereco = limparValor(servico.endereco);
                const telefone = limparValor(servico.telefone);
                const valor = limparValor(servico.valor);
                const data = new Date(servico.data).toLocaleDateString('pt-BR');
                
                return `
                    <div class="service-item">
                        <div class="service-header">
                            <div class="service-title">${nome} - ${tipo}</div>
                            <div class="service-date">${data}</div>
                        </div>
                        <div class="service-details">
                            <p>üìç ${endereco}</p>
                            <p>üìû ${telefone}</p>
                            <p>üí∞ R$ ${valor}</p>
                        </div>
                        <div class="button-group">
                            <button class="btn btn-success btn-small" onclick="gerarPDFIndividual('${servico.id}')">üìÑ PDF</button>
                            <button class="btn btn-secondary btn-small" onclick="visualizarServico('${servico.id}')">üëÅÔ∏è Ver</button>
                            <button class="btn btn-danger btn-small" onclick="excluirServico('${servico.id}')">üóëÔ∏è Excluir</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Lista de relat√≥rios
        if (relatoriosList) {
            relatoriosList.innerHTML = servicos.slice(-10).reverse().map(servico => {
                const nome = limparValor(servico.nome);
                const tipo = limparValor(servico.tipo);
                const valor = limparValor(servico.valor);
                const data = new Date(servico.data).toLocaleDateString('pt-BR');
                
                return `
                    <div class="service-item">
                        <div class="service-header">
                            <div class="service-title">${nome}</div>
                            <div class="service-date">${data}</div>
                        </div>
                        <div class="service-details">
                            <p>üîß ${tipo} | üí∞ R$ ${valor}</p>
                        </div>
                    </div>
                `;
            }).join('');
        }

        console.log('Listas atualizadas');
    }

    function atualizarEstatisticas() {
        const servicos = JSON.parse(localStorage.getItem('servicos') || '[]');
        
        const totalElement = document.getElementById('totalServicos');
        const faturamentoElement = document.getElementById('faturamentoTotal');
        
        if (totalElement) totalElement.textContent = servicos.length;
        
        if (faturamentoElement) {
            const total = servicos.reduce((acc, servico) => {
                const valorTexto = limparValor(servico.valor);
                const valor = parseFloat(valorTexto || '0');
                return acc + (isNaN(valor) ? 0 : valor);
            }, 0);
            faturamentoElement.textContent = 'R$ ' + total.toFixed(2);
        }
    }

    async function gerarPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        const servicos = JSON.parse(localStorage.getItem('servicos') || '[]');
        
        if (servicos.length === 0) {
            alert('‚ö†Ô∏è Nenhum servi√ßo para gerar relat√≥rio.');
            return;
        }

        // Cabe√ßalho
        doc.setFontSize(20);
        doc.setTextColor(0, 87, 255);
        doc.text('GESTORPOOL - RELAT√ìRIO COMPLETO v2.7', 20, 30);
        
        doc.setFontSize(12);
        doc.setTextColor(100, 100, 100);
        doc.text('Data: ' + new Date().toLocaleDateString('pt-BR'), 20, 40);
        doc.text('Total de Servi√ßos: ' + servicos.length, 20, 50);

        let yPosition = 70;

        for (let i = 0; i < servicos.length; i++) {
            const servico = servicos[i];
            
            if (yPosition > 220) {
                doc.addPage();
                yPosition = 30;
            }

            const nome = limparValor(servico.nome);
            const tipo = limparValor(servico.tipo);
            const endereco = limparValor(servico.endereco);
            const telefone = limparValor(servico.telefone);
            const valor = limparValor(servico.valor);
            const data = new Date(servico.data).toLocaleDateString('pt-BR');

            doc.setFontSize(14);
            doc.setTextColor(0, 87, 255);
            doc.text('SERVI√áO ' + (i + 1) + ':', 20, yPosition);
            yPosition += 10;
            
            doc.setFontSize(10);
            doc.setTextColor(0, 0, 0);
            doc.text('Cliente: ' + nome, 20, yPosition);
            yPosition += 5;
            doc.text('Tipo: ' + tipo, 20, yPosition);
            yPosition += 5;
            doc.text('Data: ' + data, 20, yPosition);
            yPosition += 5;
            doc.text('Valor: R$ ' + valor, 20, yPosition);
            yPosition += 5;
            doc.text('Endere√ßo: ' + endereco, 20, yPosition);
            yPosition += 5;
            doc.text('Telefone: ' + telefone, 20, yPosition);
            yPosition += 10;

            // ADICIONAR FOTOS AO PDF
            const fotos = [servico.foto1, servico.foto2, servico.foto3];
            let fotoAdicionada = false;
            
            for (let j = 0; j < fotos.length; j++) {
                const fotoData = fotos[j];
                if (fotoData && fotoData.startsWith('data:image/')) {
                    try {
                        // Calcular posi√ß√£o da foto
                        const imgWidth = 50;
                        const imgHeight = 40;
                        const imgX = 20 + (j * 55);
                        const imgY = yPosition;
                        
                        // Adicionar imagem ao PDF
                        doc.addImage(fotoData, 'JPEG', imgX, imgY, imgWidth, imgHeight);
                        fotoAdicionada = true;
                        
                        // Adicionar legenda
                        doc.setFontSize(8);
                        doc.setTextColor(100, 100, 100);
                        doc.text('Foto ' + (j + 1), imgX, imgY + imgHeight + 3);
                    } catch (error) {
                        console.warn('Erro ao adicionar foto', j + 1, ':', error);
                    }
                }
            }
            
            if (fotoAdicionada) {
                yPosition += 50;
            }
            
            // Linha separadora
            doc.setDrawColor(200, 200, 200);
            doc.line(20, yPosition, 190, yPosition);
            yPosition += 15;
        }
        
        const nomeArquivo = 'relatorio_gestorpool_v2_7_' + new Date().toISOString().split('T')[0] + '.pdf';
        doc.save(nomeArquivo);
        
        alert('‚úÖ Relat√≥rio PDF com imagens gerado com sucesso!');
    }

    async function gerarPDFIndividual(id) {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        const servicos = JSON.parse(localStorage.getItem('servicos') || '[]');
        const servico = servicos.find(s => s.id === id);
        
        if (!servico) {
            alert('‚ö†Ô∏è Servi√ßo n√£o encontrado.');
            return;
        }

        let yPosition = 60;
        
        doc.setFontSize(20);
        doc.setTextColor(0, 87, 255);
        doc.text('GESTORPOOL - RELAT√ìRIO INDIVIDUAL v2.7', 20, 30);
        
        const nome = limparValor(servico.nome);
        const tipo = limparValor(servico.tipo);
        const endereco = limparValor(servico.endereco);
        const telefone = limparValor(servico.telefone);
        const valor = limparValor(servico.valor);
        const observacoes = limparValor(servico.observacoes);
        const data = new Date(servico.data).toLocaleDateString('pt-BR');
        
        doc.setFontSize(12);
        doc.setTextColor(0, 0, 0);
        doc.text('CLIENTE: ' + nome, 20, yPosition);
        yPosition += 10;
        doc.text('TIPO: ' + tipo, 20, yPosition);
        yPosition += 10;
        doc.text('DATA: ' + data, 20, yPosition);
        yPosition += 10;
        doc.text('VALOR: R$ ' + valor, 20, yPosition);
        yPosition += 10;
        doc.text('ENDERE√áO: ' + endereco, 20, yPosition);
        yPosition += 10;
        doc.text('TELEFONE: ' + telefone, 20, yPosition);
        yPosition += 10;

        if (observacoes) {
            doc.text('OBSERVA√á√ïES: ' + observacoes, 20, yPosition);
            yPosition += 10;
        }

        yPosition += 10;

        // NOVA FUNCIONALIDADE: ADICIONAR FOTOS AO PDF INDIVIDUAL
        const fotos = [servico.foto1, servico.foto2, servico.foto3];
        const fotosExistentes = fotos.filter(foto => foto && foto.startsWith('data:image/'));
        
        if (fotosExistentes.length > 0) {
            doc.setFontSize(14);
            doc.setTextColor(0, 87, 255);
            doc.text('FOTOS DO SERVI√áO:', 20, yPosition);
            yPosition += 15;

            for (let i = 0; i < fotosExistentes.length; i++) {
                const fotoData = fotosExistentes[i];
                
                if (yPosition > 250) {
                    doc.addPage();
                    yPosition = 30;
                }
                
                try {
                    // Calcular dimens√µes da imagem
                    const imgWidth = 80;
                    const imgHeight = 60;
                    const imgX = 20;
                    
                    // Adicionar imagem ao PDF
                    doc.addImage(fotoData, 'JPEG', imgX, yPosition, imgWidth, imgHeight);
                    
                    // Adicionar legenda
                    doc.setFontSize(10);
                    doc.setTextColor(0, 87, 255);
                    doc.text('Foto ' + (i + 1), imgX, yPosition + imgHeight + 5);
                    
                    yPosition += imgHeight + 15;
                    
                } catch (error) {
                    console.warn('Erro ao adicionar foto individual', i + 1, ':', error);
                    doc.setFontSize(10);
                    doc.setTextColor(255, 0, 0);
                    doc.text('Erro ao carregar foto ' + (i + 1), 20, yPosition);
                    yPosition += 10;
                }
            }
        } else {
            doc.setFontSize(12);
            doc.setTextColor(150, 150, 150);
            doc.text('Nenhuma foto dispon√≠vel', 20, yPosition);
            yPosition += 10;
        }

        const nomeArquivo = 'relatorio_' + nome.replace(/[^a-zA-Z0-9]/g, '_') + '.pdf';
        doc.save(nomeArquivo);
        
        alert('‚úÖ Relat√≥rio individual com imagens gerado com sucesso!');
    }

    function visualizarServico(id) {
        const servicos = JSON.parse(localStorage.getItem('servicos') || '[]');
        const servico = servicos.find(s => s.id === id);
        
        if (!servico) {
            alert('‚ö†Ô∏è Servi√ßo n√£o encontrado.');
            return;
        }

        const nome = limparValor(servico.nome);
        const tipo = limparValor(servico.tipo);
        const endereco = limparValor(servico.endereco);
        const telefone = limparValor(servico.telefone);
        const valor = limparValor(servico.valor);
        const observacoes = limparValor(servico.observacoes);
        const data = new Date(servico.data).toLocaleDateString('pt-BR');

        const modalContent = document.getElementById('modalContent');
        modalContent.innerHTML = `
            <h2>Detalhes do Servi√ßo</h2>
            <div class="service-details">
                <p><strong>Cliente:</strong> ${nome}</p>
                <p><strong>Tipo:</strong> ${tipo}</p>
                <p><strong>Data:</strong> ${data}</p>
                <p><strong>Endere√ßo:</strong> ${endereco}</p>
                <p><strong>Telefone:</strong> ${telefone}</p>
                <p><strong>Valor:</strong> R$ ${valor}</p>
                ${observacoes ? `<p><strong>Observa√ß√µes:</strong> ${observacoes}</p>` : ''}
            </div>
            <div class="button-group">
                <button class="btn btn-success" onclick="gerarPDFIndividual('${servico.id}')">üìÑ Gerar PDF</button>
                <button class="btn btn-secondary" onclick="fecharModal()">Fechar</button>
            </div>
        `;
        
        document.getElementById('modal').style.display = 'block';
    }

    function fecharModal() {
        document.getElementById('modal').style.display = 'none';
    }

    function excluirServico(id) {
        if (confirm('Tem certeza que deseja excluir este servi√ßo?')) {
            const servicos = JSON.parse(localStorage.getItem('servicos') || '[]');
            const servicosFiltrados = servicos.filter(servico => servico.id !== id);
            localStorage.setItem('servicos', JSON.stringify(servicosFiltrados));
            
            atualizarListas();
            atualizarEstatisticas();
            
            alert('‚úÖ Servi√ßo exclu√≠do com sucesso!');
        }
    }

    function limparFormulario() {
        try {
            const form = document.getElementById('serviceForm');
            if (form) {
                form.reset();
            }
            
            // Limpar inputs individuais se o form n√£o existir
            const inputs = ['clienteNome', 'clienteTelefone', 'clienteEndereco', 'tipoServico', 'observacoes', 'valorServico'];
            inputs.forEach(id => {
                const elemento = document.getElementById(id);
                if (elemento) {
                    elemento.value = '';
                }
            });
            
            // Limpe inputs de foto
            const fotoInputs = ['foto1', 'foto2', 'foto3'];
            fotoInputs.forEach(id => {
                const elemento = document.getElementById(id);
                if (elemento) {
                    elemento.value = '';
                }
            });
            
            // Limpar previews das fotos
            ['preview1', 'preview2', 'preview3'].forEach(id => {
                const preview = document.getElementById(id);
                if (preview) {
                    preview.innerHTML = '<p>üì∏ Foto ' + id.replace('preview', '') + '</p>';
                }
            });
            
            // Remover classes has-image
            document.querySelectorAll('.photo-upload').forEach(div => {
                div.classList.remove('has-image');
            });
        } catch (error) {
            console.warn('Erro ao limpar formul√°rio:', error);
        }
    }

    function limparTodosDados() {
        if (confirm('‚ö†Ô∏è Isso ir√° deletar TODOS os dados. Tem certeza?')) {
            localStorage.removeItem('servicos');
            localStorage.removeItem('agendas');
            localStorage.removeItem('configuracoes');
            atualizarListas();
            atualizarEstatisticas();
            alert('‚úÖ Todos os dados foram removidos.');
        }
    }
</script>
